<html>

<head>
  <meta name="google-signin-client_id" content="<%= clientId %>">
  <script src="https://apis.google.com/js/platform.js"></script>
</head>

<body>
  <button onclick='login()'>Login</button>
  <script>
    function login() {
      gapi.load('auth2', function() {
        gapi.auth2.init({
          client_id: "<%= clientId %>",
          hosted_domain: 'utexas.edu'
        }).then(function() {
          gapi.auth2.getAuthInstance().signIn({scope: "email"}).then(function(response) {
            var xhr = new XMLHttpRequest();
              xhr.open('POST', 'https://bible-memory.herokuapp.com/authenticate');
              xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
              xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                  document.body = xhr.response;
                }
              }
              xhr.send('id=' + response.id_token);
          });
        });
      });
    }
  </script>
</body>

</html>
